
{% extends 'pos/base.html' %}
{% load static %}

{% block title %}3-L Variety Store POS{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-white to-pink-50">
    <div class="bg-[#8B4513] text-white py-4 px-6 shadow-lg mb-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">3-L Variety Store</h1>
            <div class="flex items-center gap-4">
                <button
                    id="generate-barcode-list"
                    class="text-white hover:text-white/80 hover:bg-white/10 flex items-center gap-2 px-4 py-2 rounded-md transition"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                    Generate Barcode List
                </button>
                <a href="{% url 'logout' %}" class="text-white hover:text-white/80 hover:bg-white/10 p-2 rounded-md transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </a>
            </div>
        </div>
    </div>

    <div class="p-4">
        <div id="phone-number-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h2 class="text-xl font-bold mb-4">Send Receipt via SMS</h2>
                <p class="text-gray-600 mb-4">Enter the customer's phone number to send the receipt.</p>
                <div class="mb-4">
                    <input type="text" id="phone-number-input" class="w-full border-2 border-gray-300 rounded-lg p-2 focus:border-[#8B4513] focus:outline-none" placeholder="Enter 11-digit phone number" maxlength="11" pattern="[0-9]{11}">
                </div>
                <div class="flex justify-end gap-2">
                    <button id="cancel-send-receipt" class="px-4 py-2 border border-gray-300 rounded-lg">Cancel</button>
                    <button id="confirm-send-receipt" class="px-4 py-2 bg-[#8B4513] text-white rounded-lg">Send Receipt</button>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" id="main-layout">
                <div id="product-catalog" class="glass-panel p-6 animate-in rounded-xl shadow-lg border border-white border-opacity-30 bg-white bg-opacity-80">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-[#8B4513]">Products</h2>
                        <div class="flex gap-2 items-center">
                            <button
                                id="meat-category-btn"
                                class="rounded-full shadow-md transition-all hover:scale-105 bg-[#8B4513] text-white px-4 py-2"
                            >
                                Meat
                            </button>
                            <button
                                id="vegetable-category-btn"
                                class="rounded-full shadow-md transition-all hover:scale-105 border border-gray-300 px-4 py-2"
                            >
                                Vegetable
                            </button>
                            <button
                                id="collapse-catalog-btn"
                                class="rounded-full ml-2 border border-gray-300 p-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
                            </button>
                        </div>
                    </div>

                    <div class="mb-6">
                        <div class="flex gap-2 relative">
                            <input
                                type="text"
                                id="product-search"
                                placeholder="Search products..."
                                class="flex-1 pl-10 rounded-full bg-white border-2 border-[#8B4513] focus:outline-none focus:ring-[#8B4513] p-2"
                            />
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-3 top-3 text-[#8B4513]"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                            
                            <button
                                id="scan-barcode-btn"
                                class="rounded-full bg-[#8B4513] text-white px-4 py-2 flex items-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-barcode"><path d="M3 5v14"/><path d="M8 5v14"/><path d="M12 5v14"/><path d="M17 5v14"/><path d="M21 5v14"/></svg>
                                Scan
                            </button>
                        </div>
                    </div>

                    <div id="product-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <!-- Products will be loaded here dynamically -->
                    </div>
                </div>

                <div id="cart-summary" class="glass-panel p-6 animate-in rounded-xl shadow-lg border border-white border-opacity-30 bg-white bg-opacity-80">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-[#8B4513]">Cart</h2>
                        <div class="flex gap-2">
                            <div class="flex gap-2 relative">
                                <input 
                                    type="text" 
                                    id="manual-barcode"
                                    placeholder="Enter barcode..."
                                    class="w-40 pl-9 rounded-full bg-white border-2 border-[#8B4513] focus:outline-none p-2"
                                />
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-barcode absolute left-3 top-2.5 text-[#8B4513]"><path d="M3 5v14"/><path d="M8 5v14"/><path d="M12 5v14"/><path d="M17 5v14"/><path d="M21 5v14"/></svg>
                                <button 
                                    id="manual-scan-btn"
                                    class="rounded-full h-9 bg-[#8B4513] text-white px-4 py-2"
                                >
                                    Scan
                                </button>
                            </div>
                            <a
                                href="{% url 'transactions_list' %}"
                                class="flex items-center gap-2 rounded-full shadow-md hover:shadow-lg transition-all hover:border-[#8B4513] border border-gray-300 px-4 py-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
                                Transactions
                            </a>
                        </div>
                    </div>

                    <div id="cart-items" class="max-h-[400px] overflow-y-auto pr-2 space-y-4 custom-scrollbar">
                        <div id="empty-cart-message" class="text-center py-12">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-bag mx-auto text-gray-300 mb-4"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                            <p class="text-gray-500 text-lg">Cart is empty. Add some products!</p>
                        </div>
                        <!-- Cart items will be loaded here dynamically -->
                    </div>

                    <div id="payment-section" class="mt-6 space-y-6 border-t pt-6 hidden">
                        <div id="payment-methods">
                            <h3 class="font-medium mb-3">Select Payment Method</h3>
                            <div class="grid grid-cols-3 gap-3">
                                <button data-payment="cash" class="payment-method-btn flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg hover:border-[#8B4513] transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-banknote mb-2"><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg>
                                    <span>Cash</span>
                                </button>
                                <button data-payment="card" class="payment-method-btn flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg hover:border-[#8B4513] transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mb-2"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                                    <span>Card</span>
                                </button>
                                <button data-payment="wallet" class="payment-method-btn flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-lg hover:border-[#8B4513] transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet mb-2"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>
                                    <span>E-Wallet</span>
                                </button>
                            </div>
                        </div>

                        <div id="card-payment-form" class="rounded-lg bg-white p-4 shadow-inner border border-gray-100 hidden">
                            <form id="card-form" class="space-y-4">
                                <div>
                                    <label for="card-number" class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                                    <input type="text" id="card-number" class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-[#8B4513] focus:outline-none" placeholder="1234 5678 9012 3456" maxlength="19">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="expiry-date" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                        <input type="text" id="expiry-date" class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-[#8B4513] focus:outline-none" placeholder="MM/YY" maxlength="5">
                                    </div>
                                    <div>
                                        <label for="cvv" class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                                        <input type="text" id="cvv" class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-[#8B4513] focus:outline-none" placeholder="123" maxlength="3">
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-[#8B4513] text-white py-2 rounded-lg">Process Payment</button>
                            </form>
                        </div>

                        <div id="ewallet-payment-form" class="rounded-lg bg-white p-4 shadow-inner border border-gray-100 hidden">
                            <div class="space-y-4">
                                <p class="text-gray-700">Please upload a screenshot of the payment confirmation:</p>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload mx-auto text-gray-400 mb-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                                    <p class="text-sm text-gray-600 mb-2">Click to upload or drag and drop</p>
                                    <p class="text-xs text-gray-500">PNG, JPG or JPEG (max. 5MB)</p>
                                    <input type="file" id="receipt-upload" class="hidden" accept="image/*">
                                </div>
                                <div id="upload-preview" class="hidden">
                                    <div class="relative">
                                        <img id="receipt-preview" src="#" alt="Receipt preview" class="w-full h-auto rounded-lg">
                                        <button id="remove-receipt" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                        </button>
                                    </div>
                                </div>
                                <button id="submit-ewallet" class="w-full bg-[#8B4513] text-white py-2 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                                    Confirm Payment
                                </button>
                            </div>
                        </div>
                        
                        <div class="border-t pt-6">
                            <div class="flex justify-between mb-4 items-center">
                                <span class="font-bold text-lg">Total:</span>
                                <span id="cart-total" class="font-bold text-xl text-[#8B4513]">
                                    â‚±0.00
                                </span>
                            </div>
                            <button
                                id="pay-now-btn"
                                class="w-full h-12 text-lg rounded-full shadow-lg hover:shadow-xl transition-all bg-[#8B4513] text-white disabled:bg-gray-300 disabled:cursor-not-allowed"
                                disabled
                            >
                                Pay Now
                            </button>
                        </div>
                    </div>

                    <div id="payment-complete" class="mt-6 space-y-6 animate-in hidden">
                        <div id="payment-status" class="p-6 rounded-lg shadow-inner border text-center">
                            <!-- Payment status will be shown here -->
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button
                                id="print-receipt-btn"
                                class="w-full h-12 shadow-md hover:shadow-lg transition-all rounded-full border border-gray-300 flex items-center justify-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-printer"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>
                                Print Receipt
                            </button>
                            <button
                                id="new-transaction-btn"
                                class="w-full h-12 shadow-md hover:shadow-lg transition-all rounded-full bg-[#8B4513] text-white"
                            >
                                New Transaction
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Barcode Scanner Container -->
    <div id="barcode-scanner-container" class="hidden"></div>
</div>

<!-- Quagga.js for barcode scanning from CDN -->
<script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.js"></script>
<script src="{% static 'js/camera-scanner.js' %}"></script>
<script src="{% static 'js/barcode-scanner.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}
