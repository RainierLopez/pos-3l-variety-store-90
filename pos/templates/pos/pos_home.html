
{% extends "pos/base.html" %}
{% load static %}

{% block title %}POS System{% endblock %}

{% block extra_css %}
<style>
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
    }
    
    .product-card {
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    .cart-item {
        animation: fadeIn 0.3s ease-out;
    }
    
    #cart-items {
        max-height: 350px;
        overflow-y: auto;
    }
    
    .payment-method {
        transition: all 0.2s ease;
    }
    
    .payment-method.selected {
        border-color: #8B4513;
        background-color: rgba(139, 69, 19, 0.1);
    }
    
    .animate-in {
        animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Main Grid Layout -->
    <div id="main-layout" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Left Column: Product Catalog -->
        <div id="product-catalog" class="glass-panel p-6 animate-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">Products</h2>
                <div class="flex space-x-2">
                    <button id="scan-barcode-btn" class="btn btn-outline flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M2 10h20"/></svg>
                        Scan Barcode
                    </button>
                    {% if user.profile.role == 'admin' %}
                    <a href="{% url 'inventory_management' %}" class="btn btn-outline flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M2 9V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1"/><circle cx="10" cy="16" r="2"/><path d="m22 16-3-3"/><path d="m17 16 3-3"/><path d="M8 4h1"/><path d="M13.4 13.9l-.2.1"/></svg>
                        Inventory
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <!-- Search and Category Filters -->
            <div class="mb-6">
                <div class="relative flex items-center mb-4">
                    <input type="text" id="product-search" class="form-control pl-10" placeholder="Search products or scan barcode">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 text-gray-400"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                </div>
                
                <div class="flex space-x-2">
                    <button id="meat-category-btn" class="bg-[#8B4513] text-white px-4 py-2 rounded-full text-sm">Meat</button>
                    <button id="vegetable-category-btn" class="border border-gray-300 px-4 py-2 rounded-full text-sm">Vegetable</button>
                </div>
            </div>
            
            <!-- Product Grid -->
            <div id="product-grid" class="product-grid">
                <!-- Products will be loaded here dynamically -->
                <div class="text-center py-12 col-span-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-300 mb-4"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
                    <p class="text-gray-500">Loading products...</p>
                </div>
            </div>
        </div>
        
        <!-- Right Column: Cart and Payment -->
        <div id="cart-summary" class="glass-panel p-6 animate-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">Cart</h2>
                <div class="flex space-x-2">
                    <button id="collapse-catalog-btn" class="btn btn-outline flex items-center md:hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>
                    </button>
                    <a href="{% url 'transactions_list' %}" class="btn btn-outline flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M2 10h20"/></svg>
                        Transactions
                    </a>
                </div>
            </div>
            
            <div class="flex flex-col h-full">
                <!-- Cart Items List -->
                <div class="flex-1 mb-4">
                    <div id="empty-cart-message" class="text-center py-8 bg-white rounded-lg shadow">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-300 mb-4"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                        <p class="text-gray-500">Your cart is empty</p>
                        <p class="text-gray-400 text-sm mt-2">Add items by clicking on products or scanning barcodes</p>
                    </div>
                    
                    <div id="cart-items" class="space-y-3 custom-scrollbar">
                        <!-- Cart items will be loaded here dynamically -->
                    </div>
                </div>
                
                <!-- Cart Total -->
                <div class="border-t border-gray-200 pt-4">
                    <div class="flex justify-between items-center text-lg font-bold">
                        <span>Total:</span>
                        <span id="cart-total" class="text-[#8B4513]">â‚±0.00</span>
                    </div>
                </div>
                
                <!-- Payment Section - Hidden when cart is empty -->
                <div id="payment-section" class="mt-6 hidden">
                    <h3 class="font-bold mb-3">Payment Method</h3>
                    
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <button class="payment-method-btn p-3 border rounded-lg text-center flex flex-col items-center" data-payment="cash">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1"><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg>
                            Cash
                        </button>
                        <button class="payment-method-btn p-3 border rounded-lg text-center flex flex-col items-center" data-payment="card">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                            Card
                        </button>
                        <button class="payment-method-btn p-3 border rounded-lg text-center flex flex-col items-center" data-payment="wallet">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>
                            E-Wallet
                        </button>
                    </div>
                    
                    <!-- Card Payment Form -->
                    <div id="card-payment-form" class="bg-white p-4 rounded-lg shadow-md mb-4 hidden">
                        <h4 class="font-medium mb-3">Card Details</h4>
                        <form id="card-form">
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="card-number" class="block text-sm text-gray-600 mb-1">Card Number</label>
                                    <input type="text" id="card-number" class="form-control" placeholder="XXXX XXXX XXXX XXXX" required>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="expiry-date" class="block text-sm text-gray-600 mb-1">Expiry Date</label>
                                        <input type="text" id="expiry-date" class="form-control" placeholder="MM/YY" required>
                                    </div>
                                    <div>
                                        <label for="cvv" class="block text-sm text-gray-600 mb-1">CVV</label>
                                        <input type="text" id="cvv" class="form-control" placeholder="XXX" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary w-full">Pay Now</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- E-Wallet Payment Form -->
                    <div id="ewallet-payment-form" class="bg-white p-4 rounded-lg shadow-md mb-4 hidden">
                        <h4 class="font-medium mb-3">Upload E-Wallet Receipt</h4>
                        <div class="border-dashed border-2 border-gray-300 p-6 rounded-lg text-center cursor-pointer hover:bg-gray-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-400 mb-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                            <p class="text-gray-500">Click to upload receipt image</p>
                            <p class="text-gray-400 text-xs mt-1">Supported formats: JPG, PNG</p>
                            <input type="file" id="receipt-upload" class="hidden" accept="image/*">
                        </div>
                        
                        <div id="upload-preview" class="mt-4 hidden">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-16 h-16 bg-gray-100 rounded overflow-hidden">
                                        <img id="receipt-preview" src="" alt="Receipt Preview" class="w-full h-full object-cover">
                                    </div>
                                    <div class="ml-3">
                                        <p class="font-medium">Receipt Image</p>
                                        <p class="text-xs text-gray-500">Uploaded successfully</p>
                                    </div>
                                </div>
                                <button id="remove-receipt" class="text-red-500 hover:text-red-700">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                </button>
                            </div>
                            <button id="submit-ewallet" class="btn btn-primary w-full mt-4" disabled>Complete Payment</button>
                        </div>
                    </div>
                    
                    <!-- Cash Payment Section -->
                    <button id="pay-now-btn" class="btn btn-primary w-full" disabled>Pay Now</button>
                </div>
                
                <!-- Payment Complete Section -->
                <div id="payment-complete" class="mt-6 hidden">
                    <div id="payment-status" class="mb-4">
                        <!-- Payment status will be displayed here -->
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button id="print-receipt-btn" class="btn btn-outline w-full flex justify-center items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>
                            Print Receipt
                        </button>
                        <button id="new-transaction-btn" class="btn btn-primary w-full flex justify-center items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                            New Transaction
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Phone Number Dialog -->
<div id="phone-number-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h3 class="text-lg font-bold mb-4">Send Receipt via SMS</h3>
        <p class="text-gray-600 mb-4">Enter customer's phone number to send the receipt:</p>
        
        <div class="mb-4">
            <input type="tel" id="phone-number-input" class="form-control" placeholder="Enter 11-digit phone number">
            <p class="text-xs text-gray-500 mt-1">Format: 09XXXXXXXXX</p>
        </div>
        
        <div class="flex justify-end space-x-3">
            <button id="cancel-send-receipt" class="btn btn-outline">Cancel</button>
            <button id="confirm-send-receipt" class="btn btn-primary">Send Receipt</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}
